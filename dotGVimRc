" Problem: On windows, if set as -U, it won't run *after* the -u set .vimrc is
" executed.
" Why even have a .gvimrc? Because some settings can only be set here for gui
" apps:
" https://vi.stackexchange.com/a/473
" For example t_vb, and application menus.
"
" Potential Solution: Can't the GUI specific settings be set in autocommands?
"
"   if has('autocmd')
"     autocmd GUIEnter * set visualbell t_vb=
"   endif
" (Note: I found another solution to visual bell that doesn't even involve
" gvimrc, but for other settings like menus, we need something that works on
" all platforms when we use `-u` and/or `-U`. I think autocommands might be
" the answer.

" When overriding init files, the standard ones don't get sourced.  We set
" `VIMBOX_OVERRIDING_INIT` to tell these loading scripts they need to source
" the system vimrcs.  See `./developerDocs/LOCATIONS.md`
if ($VIMBOX_OVERRIDING_INIT)
  let g:vimBoxInitialVimRcPath = resolve(expand('<sfile>:p'))
  let g:vimBoxInstallationRoot = fnamemodify(g:vimBoxInitialVimRcPath, ':h')
  if g:vimBoxOs == 'windows'
    " Cygwin installed vim
    if g:vimBoxSupportsUnix
    else
      " GVim binary (command line or GUI)
    endif
  elseif g:vimBoxOs == 'osx'
    exec "source " . $VIM . "/gvimrc"
  elseif g:vimBoxOs == 'linux'
    "if file_readable($VIM . '/vim82/gvimrc_example.vim')
    "  exec "source " . $VIM . "/vim82/gvimrc_example.vim"
    "else
      if file_readable($VIM . '/gvimrc')
        exec "source " . $VIM . '/gvimrc'"
      endif
    "endif
  endif
endif

if has('gui')
  if has("gui_macvim")

    " xxxxxx Required for Closer.vim()
    " Found a better way that doesnt require mapping this!
    " " macmenu &File.Close key=<nop>

    " Before:
    "  New Tab: CMD-t
    "  New Window: CMD-N
    "  Open Tab: CMD-T
    "  Show Errors: CMD-l
    " After:
    "  New Tab: CMD-n
    "  New Window: CMD-N
    "  Open Tab: No such thing
    "  Show Errors: unmapped
    macmenu &File.New\ Window key=<nop>
    macmenu &File.New\ Tab key=<nop>
    macmenu &Tools.List\ Errors key=<nop>
    " Clear this up for something like CMD+t
    macmenu &File.Open\ Tab\.\.\. key=<nop>
    macmenu &Tools.Make key=<nop>

    " Clear these up - if you want them back you can remap them
    " in Vim.
    macmenu &Edit.Find.Findâ€¦ key=<nop>
    " macmenu &Edit.Find.Find\.\.\. key=<nop>
    macmenu &Edit.Find.Find\ Next key=<nop>
    macmenu &Edit.Find.Find\ Previous key=<nop>
    macmenu &Edit.Find.Use\ Selection\ for\ Find key=<nop>



    macmenu &File.New\ Window key=<D-N>
    if g:vimBox_tabSystem == 'wintabs' || 1
      " Let the vim keybindings handle it.
      macmenu &File.Close key=<nop>
      macmenu  Window.Show\ Next\ Tab	key=<nop>
      macmenu  Window.Show\ Previous\ Tab	key=<nop>
      macmenu Window.Toggle\ Full\ Screen\ Mode key=<D-CR>
    else
      macmenu &File.New\ Tab key=<D-n>
      macmenu Window.Toggle\ Full\ Screen\ Mode key=<D-c-f>
    endif


    " From subvim:
    " Disable print shortcut for 'goto anything...'
    macmenu File.Print key=<nop>

    " From subvim: Why do this again? Why not just swap like I've done?
    " create a new menu item with title "New File" and bind it to cmd+n
    " new files will be created on a new tab
    " an 10.190 File.New\ File <nop>
    " macmenu File.New\ File action=addNewTab: key=<D-n>

    " To the right of Edit.
    let  g:bmenu_priority=21
    " remove old menu, if exists; keep one entry to avoid a torn off menu to
    " disappear.
    silent! unmenu &Settings
    exe 'noremenu ' . g:bmenu_priority . ".1 &Settings.Dummy l"
    silent! unmenu! &Buffers

    " create new menu; set 'cpo' to include the <CR>
    let cpo_save = &cpo
    set cpo&vim
    exe 'an ' . g:bmenu_priority . ".2 &Settings.&UserSettings :execute 'e ' . g:vimBoxUserSettings<CR>"
    exe 'an ' . g:bmenu_priority . ".2 &Settings.&DefaultSettings :execute 'e ' . g:vimBoxSettingsDefault<CR>"
    macmenu &Settings.UserSettings key=<D-,>
    let &cpo = cpo_save
    unmenu &Settings.Dummy

  endif
endif


set visualbell
set t_vb=

if file_readable(g:vimBoxUserGVimInit)
  execute "source " . g:vimBoxUserGVimInit
endif
